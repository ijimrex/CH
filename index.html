<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FB search</title>
    <link rel="stylesheet" href="fb.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
<div id="whole-background" ng-app="myApp" ng-controller="fbController">
    <div id="headbar">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img alt="FB Search" src="...">
                </a>
                <form class="navbar-form navbar-left" role="search" >
                    <div class="form-group" style="width: 300px">
                        <input ng-model="keyword" type="text" class="form-control" placeholder="Search" style="border-radius: 0px;width:100%">
                    </div>
                    <button type="submit" class="btn btn-primary"style="border-radius: 0px" ng-click="search()">&nbsp;&nbsp; <span class="glyphicon glyphicon-search" aria-hidden="true">&nbsp;</span></button>
                    <button type="submit" class="btn btn-default"style="border-radius: 0px" ng-click="reset()" >Clear</button>
                </form>
            </div>
        </nav>
    </div>
    <div id="tags">
        <ul class="nav nav-pills nav-justified" role="tablist" >
            <li class="active" style="border-radius: 0px" id="tuser"role="presentation"><a style="border-radius: 0px" href="#user" data-toggle="tab">Users</a></li>
            <li role="presentation"><a href="#page" style="border-radius: 0px" id="tpage" data-toggle="tab">Pages</a></li>
            <li role="presentation"><a href="#event" style="border-radius: 0px" id="tevent" data-toggle="tab">Events</a></li>
            <li role="presentation"><a href="#place" style="border-radius: 0px" id="tplace" data-toggle="tab">Places</a></li>
            <li role="presentation"><a href="#group" style="border-radius: 0px" id="tgroup" data-toggle="tab">Groups</a></li>
            <li role="presentation"><a href="#favourite" style="border-radius: 0px" id="tfavourite" data-toggle="tab">Favourites</a></li>
        </ul>
    </div>


    <!--{{keyword}}-->
    <!--{{lat}}-->
    <div class="progress"  id ='progressbar'>
        <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
            <span class="sr-only">60% Complete</span>
        </div>
    </div>
<!--user-->
    <!--{{placepage.pre}}-->
    <!--{{placepage.next}}-->
    <div class="tab-content" id="tc">
    <div id="user" class="tab-pane fade in active">
        <table class="table">
            <thead>
            <tr>
                <th>#</th>
                <th>Profile Photo</th>
                  <th>Name</th>
                <th>Favourite</th>
                <th>Details</th>
            </tr>
            </thead>
            <tbody>

            <tr ng-repeat="user in users">
                <td>{{user.num}}</td>
                <td><img src="{{user.picurl}}"  class="img-circle" style="width: 64px;height: 64px"></td>
                <td>{{ user.name }}</td>
                <td><button class="btn btn-default" type="button" ><span class="glyphicon glyphicon-star-empty"></span></button></td>
                <td><button class="btn btn-default" type="button>"><span class="glyphicon glyphicon-chevron-right"></span></button></td>
            </tr>
            </tbody>
        </table>
        <ul class="pager">
            <li ng-if="userpage.pre" ng-click="userpreviouspage()"><a href="#user" >Previous</a></li>
            <li ng-if="userpage.nex" ng-click="usernextpage()"><a href="#user" >Next</a></li>
        </ul>
    </div>

<!--page-->

    <div id="page"  class="tab-pane fade">
        <table class="table">
            <thead>
            <tr>
                <th>#</th>
                <th>Profile Photo</th>
                <th>Name</th>
                <th>Favourite</th>
                <th>Details</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="page in pages">
                <td>{{page.num}}</td>
                <td><img src="{{page.picurl}}"  class="img-circle" style="width: 64px;height: 64px"></td>
                <td>{{ page.name }}</td>
                <td><button class="btn btn-default" type="button" ><span class="glyphicon glyphicon-star-empty"></span></button></td>
                <td><button class="btn btn-default" type="button>"><span class="glyphicon glyphicon-chevron-right"></span></button></td>
            </tr>
            </tbody>
        </table>
        <ul class="pager">
            <li ng-if="pagepage.pre" ng-click="pagepreviouspage()"><a href="#page" >Previous</a></li>
            <li ng-if="pagepage.nex" ng-click="pagenextpage()"><a href="#page" >Next</a></li>
        </ul>

    </div>


<!--event-->
    <div id="event" class="tab-pane fade">
        <table class="table">
            <thead>
            <tr>
                <th>#</th>
                <th>Profile Photo</th>
                <th>Name</th>
                <th>Favourite</th>
                <th>Details</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="event in events">
                <td>{{event.num}}</td>
                <td><img src="{{event.picurl}}"  class="img-circle" style="width: 64px;height: 64px"></td>
                <td>{{ event.name }}</td>
                <td><button class="btn btn-default" type="button" ><span class="glyphicon glyphicon-star-empty"></span></button></td>
                <td><button class="btn btn-default" type="button>"><span class="glyphicon glyphicon-chevron-right"></span></button></td>
            </tr>
            </tbody>
        </table>
        <ul class="pager">
            <!--<li ng-if="eventpage.pre" ng-click="eventpreviouspage()"><a href="#event" >Previous</a></li>-->
            <li ng-if="eventpage.nex" ng-click="eventnextpage()"><a href="#event" >Next</a></li>
        </ul>

    </div>
<!--place-->
    <div id="place" class="tab-pane fade">

        <table class="table">
            <thead>
            <tr>
                <th>#</th>
                <th>Profile Photo</th>
                <th>Name</th>
                <th>Favourite</th>
                <th>Details</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="place in places">
                <td>{{place.num}}</td>
                <td><img src="{{place.picurl}}"  class="img-circle" style="width: 64px;height: 64px"></td>
                <td>{{ place.name }}</td>
                <td><button class="btn btn-default" type="button" ><span class="glyphicon glyphicon-star-empty"></span></button></td>
                <td><button class="btn btn-default" type="button>"><span class="glyphicon glyphicon-chevron-right"></span></button></td>
            </tr>
            </tbody>
        </table>
        <ul class="pager">
            <!--<li ng-if="placepage.pre" ng-click="placepreviouspage()"><a href="#place" >Previous</a></li>-->
            <li ng-if="placepage.nex" ng-click="placenextpage()"><a href="#place" >Next</a></li>
        </ul>
    </div>
<!--group        -->
    <div id="group" class="tab-pane fade">
        <table class="table">
            <thead>
            <tr>
                <th>#</th>
                <th>Profile Photo</th>
                <th>Name</th>
                <th>Favourite</th>
                <th>Details</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="group in groups">
                <td>{{group.num}}</td>
                <td><img src="{{group.picurl}}"  class="img-circle" style="width: 64px;height: 64px"></td>
                <td>{{ group.name }}</td>
                <td><button class="btn btn-default" type="button" ><span class="glyphicon glyphicon-star-empty"></span></button></td>
                <td><button class="btn btn-default" type="button>"><span class="glyphicon glyphicon-chevron-right"></span></button></td>
            </tr>
            </tbody>
        </table>
        <ul class="pager">
            <li ng-if="grouppage.pre" ng-click="grouppreviouspage()"><a href="#group" >Previous</a></li>
            <li ng-if="grouppage.nex" ng-click="groupnextpage()"><a href="#group" >Next</a></li>
        </ul>
        </ul>
    </div>
<!--facourite        -->
    <div id="favourite" class="tab-pane fade" ></div>
</div>
</div>

<script>
    var app = angular.module('myApp', []);
    app.controller('fbController', function($scope,$http) {
        navigator.geolocation.getCurrentPosition(function(position) {
            $scope.lat=position.coords.latitude;
            $scope.long=position.coords.longitude;;
        });

        $scope.keyword ="";
//        $scope.urls='fb.php?keyword='+$scope.keyword+'&lat='+$scope.lat+'&long='+$scope.long;
        $scope.users=""
        $scope.pages=""
        $scope.events=""
        $scope.groups=""
        $scope.places=""
        $scope.userpage=""
        $scope.pagepage=""
        $scope.eventpage=""
        $scope.grouppage=""
        $scope.placepage=""
        $scope.reset=function (){
            $scope.keyword =""
        }

        function show(id){
            document.getElementById(id).style.display='block'

        }
        function hide(id){
            document.getElementById(id).style.display='none'

        }

        function parseData(data) {
//            console.log(data)
            var temp=Array()
            var len=data.length;
            for (var i=0;i<len;i++){
                temp.push({
                    num: i+1,
                    id: data[i]['id'],
                    name: data[i]['name'],
                    picurl: data[i]['picture']['data']['url'],
                })
            }
            return temp
        }

        $scope.search=function () {
            hide('tc')
            show('progressbar')
            $http({
                method: 'GET',
                url: 'fb.php?&keyword='+$scope.keyword+'&lat='+$scope.lat+'&long='+$scope.long
            }).then(function successCallback(response) {
//                console.log(response['data']['user']['data'])
                $scope.users=parseData(response['data']['user']['data'])
                $scope.events=parseData(response['data']['event']['data'])
                $scope.pages=parseData(response['data']['page']['data'])
                $scope.places=parseData(response['data']['place']['data'])
                $scope.groups=parseData(response['data']['group']['data'])

                $scope.userpage={next:response['data']['user']['paging']['next'],pre:false,nex:true}
                $scope.eventpage={next:response['data']['event']['paging']['next'],pre:false,nex:true}
                $scope.pagepage={next:response['data']['page']['paging']['next'],pre:false,nex:true}
                $scope.placepage={next:response['data']['place']['paging']['next'],pre:false,nex:true}
                $scope.grouppage ={next:response['data']['group']['paging']['next'],pre:false,nex:true}

                hide('progressbar')
                show('tc')
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
//user
        $scope.usernextpage=function () {
            $http({
                method: 'GET',
                url: $scope.userpage['next']
            }).then(function successCallback(response) {
                $scope.users=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['next']!=undefined && response['data']['paging']['next']!='')
                { $scope.userpage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.userpage={next:"",previous:response['data']['paging']['previous'],nex:false,pre:true}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
        $scope.userpreviouspage=function () {
            $http({
                method: 'GET',
                url: $scope.userpage['previous']
            }).then(function successCallback(response) {
                console.log(response['data']['paging'])
                $scope.users=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['previous']!=undefined && response['data']['paging']['previous']!='')
                { $scope.userpage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.userpage={next:response['data']['paging']['next'],previous:"1",nex:true,pre:false}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
//page
        $scope.pagenextpage=function () {
            $http({
                method: 'GET',
                url: $scope.pagepage['next']
            }).then(function successCallback(response) {
                $scope.pages=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['next']!=undefined && response['data']['paging']['next']!='')
                { $scope.pagepage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.pagepage={next:"",previous:response['data']['paging']['previous'],nex:false,pre:true}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
        $scope.pagepreviouspage=function () {
            $http({
                method: 'GET',
                url: $scope.pagepage['previous']
            }).then(function successCallback(response) {
                $scope.pages=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['previous']!=undefined && response['data']['paging']['previous']!='')
                { $scope.pagepage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.pagepage={next:response['data']['paging']['next'],previous:"",nex:true,pre:false}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
//group
        $scope.groupnextpage=function () {
            $http({
                method: 'GET',
                url: $scope.grouppage['next']
            }).then(function successCallback(response) {
                $scope.groups=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['next']!=undefined && response['data']['paging']['next']!='')
                { $scope.grouppage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.grouppage={next:"",previous:response['data']['paging']['previous'],nex:false,pre:true}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
        $scope.grouppreviouspage=function () {
            $http({
                method: 'GET',
                url: $scope.grouppage['previous']
            }).then(function successCallback(response) {
                $scope.groups=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['previous']!=undefined && response['data']['paging']['previous']!='')
                { $scope.grouppage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.grouppage={next:response['data']['paging']['next'],previous:"",nex:true,pre:false}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
        //event
        $scope.eventnextpage=function () {
            $http({
                method: 'GET',
                url: $scope.eventpage['next']
            }).then(function successCallback(response) {
                $scope.events=parseData(response['data']['data'])
                console.log(response['data']['paging'])
                if (response['data'].hasOwnProperty('paging')&& response['data']['paging']['next']!=undefined && response['data']['paging']['next']!='')
                { $scope.eventpage={next:response['data']['paging']['next'],nex:true,pre:false}}
                else{
                    $scope.eventpage={next:"",nex:false,pre:false}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
//        $scope.eventpreviouspage=function () {
//            $http({
//                method: 'GET',
//                url: $scope.eventpage['previous']
//            }).then(function successCallback(response) {
//                $scope.events=parseData(response['data']['data'])
//                if (response['data'].hasOwnProperty('paging')&&response['data']['paging']['previous']!=undefined && response['data']['paging']['previous']!='')
//                { $scope.eventpage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
//                else{
//                    $scope.eventpage={next:response['data']['paging']['next'],previous:"",nex:true,pre:false}
//                }
//            }, function errorCallback(response) {
//                console.log('http error')
//            });
//        }
//place
        $scope.placenextpage=function () {
            $http({
                method: 'GET',
                url: $scope.placepage['next']
            }).then(function successCallback(response) {
                $scope.places=parseData(response['data']['data'])
                if (response['data']['paging']!=undefined&&response['data']['paging']['next']!=undefined && response['data']['paging']['next']!='')
                { $scope.placepage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
                else{
                    $scope.placepage={next:"",nex:false,pre:false}
                }
            }, function errorCallback(response) {
                console.log('http error')
            });
        }
//        $scope.placepreviouspage=function () {
//            $http({
//                method: 'GET',
//                url: $scope.placepage['previous']
//            }).then(function successCallback(response) {
//                console.log(response)
//                $scope.places=parseData(response['data']['data'])
//                if (response['data']['paging']!=undefined&&response['data']['paging']['previous']!=undefined && response['data']['paging']['previous']!='')
//                { $scope.placepage={next:response['data']['paging']['next'],previous:response['data']['paging']['previous'],nex:true,pre:true}}
//                else{
//                    $scope.placepage={next:response['data']['paging']['next'],previous:"",nex:true,pre:false}
//                }
//            }, function errorCallback(response) {
//                console.log('http error')
//            });
//        }
    });

</script>
</body>
</html>